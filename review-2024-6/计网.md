${toc}

# 计算机网络概述

## 计算机网络概念

### 定义

将具有**独立功能**的**多台计算机**通过**通信线路连接**，实现**资源共享**和信息传递的计算机系统

### 组成

- 终端系统\/资源子网: 提供共享的软件资源和硬件资源(如视频，音频)
- 通信子网: 提供信息交换的网络节点和通信线路(按网线理解)

### 网络类型

#### 按拓扑结构

- 星型
- 树型
- 总线型
- 环型
- 网状型

![拓扑](images/cm_topology.png)

#### 按范围分类

- 局域网 LAN
  - 小区，家中
- 城域网 MAN
  - 城市
- 广域网 WAN
  - 国家，省之间
- 个人区域网 PAN
  - 服务于个人

#### 按照传输方式

- 有线
  - IEEE802.3
  - IEEE802.11
- 无线
  - 无线局域网WLAN
  - 无线个域网WPAN

## 计算机网络体系结构

### 传输方式

#### 传输方式

1. 按传输方向分
    - 单工: 只能单方向传输
    - 双工: 在同一时间，先路上只允许一个方向的数据通过
    - 全双工: 双方能够同时进行数据通信
2. 按传输对象分
    - 单播: 1对1
    - 多播: 1对多
    - 广播: 1对all

#### 数据交换

1. 电路交换
    - 整个报文从头到尾连续传输，占用整条线路
2. 报文交换
    - 不会占用整个信道，整个报文先传送到相邻节点，全部存储下来查找换发表，再转发到下一个结点
3. 分组交换
    - 将数据包分组，之后传送到相邻结点，再查找转发表转发(分组传输)

#### 通信协议和体系结构

##### 网络协议三要素

- 语义
  - 控制信息每个部分的意义，规定了需要发出何种控制信息，以及完成的动作与做出什么样的响应。
- 语法
  - 用来规定信息格式，数据及控制信息的格式、编码及信号电平等
- 时序
  - 时序是对事件发生顺序的详细说明(也可称为“同步”)

语义表示要做什么，语法表示要怎么做，时序表示做的顺序。

##### OSI参考模型

1. 应用层
    - 提供网络服务和应用程序接口（如HTTP、FTP、SMTP）
2. 表示层
    - 处理数据格式和加密（如数据压缩、加密）
3. 会话层
    - 管理会话和连接（如建立、维护、终止会话）
4. 传输层
    - 提供端到端的通信和数据完整性（如TCP、UDP）
5. 网络层
    - 单位 分组，负责数据包的路由选择和转发（如IP地址、路由器）
6. 数据链路层
    - 单位 帧，负责节点之间的数据传输和错误检测（如MAC地址、以太网）
7. 物理层
    - 单位bit，处理物理传输介质（如电缆、光纤）和信号传输

##### TCP/IP参考模型

1. 应用层
    - 应用层
    - 表示层
    - 会话层
2. 传输层
3. 网际层
    - 网络层
4. 网络接口层
    - 数据链路层
    - 物理层

## 习题

1. **试从多个方面比较电路交换、报文交换和分组交换的主要优缺点**

    - 电路交换
        - 特点
            - 通信有三阶段：建立链接、通信、释放连接，**通信过程始终占用物理信道**
        - 优点
            - 静态分配传输带宽，建立连接后通信双方所需传输带宽不会再变
            - 双方通信不收其他用户影响，占用通信资源时间不受限制
        - 缺点
            - 通信线路利用率较低
            - 整个链接中只要有一条链路或交换机出现故障就会引发通信中断
    - 分组交换
        - 特点
            - 以**报文分组**作为传输单位，采用**存储转发**技术
        - 优点
            - 无连接建立释放截断，传送数据迅速
            - 动态分配带宽，合理运用各链路传输带宽
            - 采用分布式路由选择协议，某个节点或链路出现故障分组传送路由可以动态改变，继续传输数据
        - 缺点
            - 路由器存储转发需排队，造成时延
            - 动态分配传输带宽，各段链路带宽不同，当网络某处通信量突然增大，可能在网络中某处产生拥塞，延长数据传输时间
            - 分组必须携带控制信息，产生额外开销，且需要专门的管理和控制机制
    - 报文交换
        - 特点
            - 以**整个报文**为传输单位，采用**存储转发**技术
        - 优点
            - 省去分组与重装报文的过程
        - 缺点
            - 灵活性不如分组交换，且时延较大

2. **计算机网络有哪些常用的性能指标？**

    - 速率
        - 数据的传送速率
    - 带宽
        - 单位时间内从网络中一点到另一点能通过的最高数据率
    - 吞吐量
        - 单位时间内通过某个网络的数据量
    - 时延
        - 数据从网络一端到另一端的时间
    - 时延带宽积
        - 传播时延和带宽的乘积
    - 往返时间RTT
        - 发送数据到接受确认的时间
    - 利用率
        - 信道利用率: 信道有百分之几的时间被利用
        - 网络利用率: 全网络信道利用率的加权平均值

3. **假设信号在媒体上的传播速度为2.3×10^8m/s.媒体长度L分别为：**

    1. **10cm（网络接口卡）**
    2. **100m（局域网）**
    3. **100km（城域网）**
    4. **5000km（广域网）**

    **试计算出当数据率为1Mb/s和10Gb/s时在以上媒体中正在传播的比特数。**

    媒体长度为信道中数据的长度，计算传播时延(根据数据长度和传播速度计算已经传播了多长时间)，和数据率相乘得到正在传播的比特数

    解:

    1. 传播时延: $0.1\div(2.3×10^8)=4.35 \times 10^{-10}$ bits

        1Mb/s: $4.35 \times 10^{-10} \times 10^6=4.35 \times 10^{-4}$ bits

        1Gb/s: $4.35 \times 10 * 10^{-10} \times 10^9=4.35$ bits

    2. 传播时延: 传播时延: $100\div(2.3×10^8)=4.35 \times 10^{-7}$ bits

        1Mb/s: $4.35 \times 10^{-7} \times 10^6=0.435$ bits

        1Gb/s: $4.35 \times 10 * 10^{-7} \times 10^9=4.35 \times 10^3$ bits

    3. 传播时延: 传播时延: $(10 ^ 5)\div(2.3×10^8)=4.35 \times 10^{-4}$ bits

        1Mb/s: $4.35 \times 10^{-4} \times 10^6=435$ bits

        1Gb/s: $4.35 \times 10 * 10^{-4} \times 10^9=4.35 \times 10^6$ bits

    4. 计算方法与上面相同

4. **论述具有五层协议的网络体系结构的要点，包括各层的主要功能。**

    综合OSI和TCP/IP

    - 应用层: 直接性为用户的应用进程提供服务
    - 运输层: 向两台主机中进程之间的通信提供通用的数据传输服务，主要使用传输控制协议(TCP)或用户数据报协议(UDP)
    - 网络层: 把运输层的报文段或用户数据报封装成分组或包，通过路由器选择和转发
    - 数据链路层: 把网络层的IP数据包组装成帧，在两个相邻节点间的链路上传输
    - 物理层: 传输比特流

5. **假定要在网络上传送1.5MB的文件。设分组长度为1KB，往返时间RTT=80ms。传送数据之前还需要有建立TCP连接的时间，这时间时2\*RTT=160ms。试计算在以下几种情况下接收方收完该文件的最后一个比特需要的时间。**

    1. **数据发送速率为10Mbit/s，数据分组可以连续发送。**
    2. **数据发送速率为10Mbit/s，但每发送完一个分组后要等待一个RTT时间才能在发送下一个分组。**
    3. **数据发送速率极快，可以不考虑发送数据所需要的时间。但规定在每一个RTT往返时间内只能发送20个分组。**
    4. **数据发送速率极快，可以不考虑发送数据所需要的时间。但在第一个RTT往返时间内只能发送一个分组，在第二个RTT内可以发送两个分组，在第三个RTT内可以发送四个分组。**
       解:

        - 1MB = 2^10 KB = 2^20 B = 2^23 bits
        - 1Mbit = 10^3Kbits = 10^6bits
        - RTT为往返时间，同时包含发送时间和返回时间
        - 数据包从发送到接收消耗的时间为0.5\*RTT(发送到接收，不包含返程)，最后一个数据包也是同样
        - 除了将数据完全发送出去的时间外，还要计算最后数据包从发送方到接收方消耗的时间

        1. t = 2\*RTT(建立TCP链接) + (1.5\* 2^23)/(10 \* 10^6) + 0.04s = 0.16s + 1.258s = 1.458s
        2. 1.5MB = 1.5\*(2^10)KB = 1536 KB = 1536 组
            - 建立时间: 2RTT = 0.16s
            - 总发送时间(不算其他的RTT)仍然是1.258s
            - 最后一个数据包到达目的地需要0.5RTT = 0.04s
            - 其他的RTT: (1536 - 1) \* 0.16 = 122.8s
            - 总时间: 0.16 + 1.258 + 0.04 + 122.8 = 124.258s
        3. 1536 // 20 = 76
            - 1536 % 20 = 16
            - 一个RTT时间发送20个分组，意思是一个RTT只能发送20个分组，如果一次性没超过就不需要等待
            - 并且不考虑发送数据所需时间，但是仍需要计算最后一个分组到终点所需时间
            - t = 2RTT + 76RTT + 0.5RTT = 6.12 + 0.16 = 6.28s
        4. 第一个RTT发送1个，第二个RTT发送2个，第三个RTT发送4个，第n个分组发送2^(n - 1)个分组
            - 一共发送n = 1 \* (1 - 2^(n - 1)) / (1 - 2) = 2^(n - 1) - 1组
            - 2^(n - 1) - 1 >= 1536 => n >= 11，所以最少11个RTT，最后一个RTT不足20组不需要等
            - 总共需要时间 t = (2 + 10 + 0.5)RTT = 1s

# 物理层

### 信道的极限容量

#### 信噪比

信噪比(dB) $=10 \log_{10}(S/N)$ dB

香农公式(信道的极限信息传输速率)

$$C = W \log_{2}(1+S/N)$$

最高码元速率$R$，码元振幅等级$n$
$$C=Rlog_{2}(n)$$

## 信道复用技术

### 频分

### 时分

### 码分

### 波分

## 习题

1. **假定某信道受奈氏准则限制的最高码元速率为20000码元／秒。如果采用振幅调制，把码元的振幅划分为16个不同等级来传送，那么可以获得多高的数据率( bit / s )?**

    $$C = 20000 \times log_{2}(16) = 80000 bit/s $$

2. **为什么要使用信道复用技术？常用的信道复用技术有哪些？**

    - 为了通过共享信道,最大限度提高信道利用率。
    - 频分、时分、码分、波分。

3. **试写出下列英文缩写的全文，并做简单的解释。FDM，FDMA,TDM,STDM,WDM,DWDM,CDMA,SONET,SDH,STM-1 ,OC-48.**

    - FDM: Frequency Division Multiplexing 频分复用
    - FDMA: Frequency Division Multiple Access 频分多址接入
    - TDM: Time Division Multiplexing 时分复用
    - STDM: Statistic Time Division Multiplexing 统计时分复用
    - WDM: Wavelength Division Multiplexing 波分复用
    - DWDM: Dense Wave Division Multiplexing 密集波分复用
    - CDMA: Code Wave Division Multiplexing 码分复用
    - SONET: Synchronous Optical Network 同步光纤网
    - SDH: Synchronous Digital Hierarchy 同步数字系列
    - STM-1: Synchronous Trasfer Module 第一级同步传递模块
    - OC-48: Optical Carrier 第48级光载波

4. **共有4个站进行码分多址通信。4个站的码片序列为 A：（－1－1－1＋1＋1－1＋1＋1） B：（－1－1＋1－1＋1＋1＋1－1） C：（－1＋1－1＋1＋1＋1－1－1） D：（－1＋1－1－1－1－1＋1－1） 现收到这样的码片序列S：（－1＋1－3＋1－1－3＋1＋1）。问哪个站发送数据了？发送数据的站发送的是0还是1？**
    - A站: $S \cdot A = (1 - 1 + 3 + 1 - 1 + 3 + 1 + 1)/8 = 1$, 发送1
    - B站: $S \cdot B = (1 - 3 - 3 - 1 - 1 - 3 + 1 - 1)/8 = -1$, 发送-1
    - C站: $S \cdot C = (1 + 1 + 3 - 1 + 1 + 3 + 1 - 1)/8 = 0$, 无发送
    - D站: $S \cdot D = (1 + 1 + 3 - 1 + 1 + 3 + 1 - 1)/8 = 1$, 发送1

# 数据链路层

### 差错检测

#### 循环冗余检测(CRC)

1. 发送端将数据划分成组，每组k个比特
2. 在每组数据后添加供差错检测的的n位**冗余码**，构成一个帧发送出去，一共发送(k+n)位
3. 接收端将收到的数据以帧为单位进行CRC校验

CRC多项式: $P(X) = X^4+X+1$ 即除数 10011

#### 帧检验序列(FCS)

与CRC不是同一个概念，CRC是**检错方法**，FCS是添加的**冗余码**

发送端:

1. 二进制模2运算进行2^n乘M的运算，相当于在M后添加n个0
2. 将得到的数除以双方事先约定的长度为(n+1)位的除数P，得到余数R(n位，比P少一位)
3. 余数R作为冗余码拼接在M后面发送出去

接收端:

1. 把收到的每一个帧除以除数P(模2运算)，然后检查得到的余数R
2. 如果传输无差错，R一定是0

### CSMA/CD协议(多点接入载波监听/冲突检测)

> 电磁波在**1km**电缆传播时延约为**5 μs**

多点接入说明是总线型网络，计算机以多点接入的方式连接在一根总线上，协议的实质是"**载波监听**"和"**碰撞检测**"。

- 载波监听: 检测信道，确定**有没有其他计算机也在发送**，为了获得发送权
- 碰撞检测: 发送中检测信道，及时发现其他站和本站发送的碰撞。边发送数据边检测信道上的信号电压变化情况，判断自己发送数据时其他站是否也在发送(检测信道电压是否超过限值)

![载波监听](images/csma.png)

- 从图中可以看出，每个站在自己发送数据之后的一小段时间内，存在着遭遇碰撞的可能性。（这个时间是2t，t由两站之间的距离决定）这是以太网发送的不确定性。正是这种不确定性使得以太网的平均通信量远小于以太网的最高数据率。
- 以太网端到端的往返时间2t称为**争用期**（碰撞窗口）

#### 最短帧长

为了实现CSMA/CD,需要限定帧的长度。这是因为一旦整个帧被被发送了，站点就**无法保留帧的副本**并**无法掌控线路中的冲突检测**。因此，帧的传输时间tr必须至少是最长传播时间t的2倍。

#### 截断二进制指数退避

- 发生碰撞的站停止发送数据后，不是等待信道空闲后再立即发送数据，而**是退避一个随机的时间**以减小再次发生碰撞的概率
- 因为有**载波监听**，所以再次发送前能检测到信道忙，不会马上发送数据

1. 协议规定基本退避时间为2t，2t通常取51.2μs
2. 从离散的整数集合$\{0, 1, \ldots, 2^k-1\}$中随机取一个数，记为r，重传应推后时间是r倍的争用期
    $$
    k=Min[重传次数, 10]
    $$
    重传次数≤10时，参数k等于重传次数；当重传次数>10时，k=10
3. 重传次数≥16，丢弃帧并向高层报告

### 以太网交换机自学习功能

[外部链接](https://www.cnblogs.com/YXBLOGXYY/p/15401671.html)

交换机接收到帧，之后在交换表查找帧目的MAC地址对应接口，分存在和不存在两种情况

- 交换表存在
    直接转发到对应接口
- 不存在
  - 向所有接口广播该地址，正确接口的设备会响应，其他会丢弃，之后将接口写入到交换表中。交换表还会记录时间，保证自动删除
  - 要保证一台主机到其他主机的路径是**无环路树状结构**，避免兜圈子

## 习题

[CSDN](https://blog.csdn.net/weixin_45773137/article/details/126276788)

课本 04 07 14 20 24 29

1. 数据链路层的三个基本问题(封装成帧、透明传输和差错检测)为什么都必须加以解决？

    封装成帧: 数据前后加上帧头尾，接收端数据链路层收到物理层传来的比特流才能**根据帧头尾识别成一个帧**

    透明传输: 防止数据中出现与帧定界符相同的比特组合导致出现帧定界错误，在**发送端数据中帧定界符前加上转义符，接收端去掉**，使数据无差错地通过数据链路层，实现透明传输

    差错检验: 使**错误数据到达节点或主机的数据链路层就能被尽快检测到**，而不是到达主机后，主机的高层软件进行检测，使错误数据尽少的占用通信资源，节约网络资源

2. 要发送的数据为1101011011。采用CRC的生成多项式是$P(X) = X^4+X+1$试求应添加在数据后面的余数。
   $P(X) = X^4+X+1$ = 10011，除数为10011

    - 数据在传输过程中最后一个1变成了0，问接收端能否发现？

        能，添加冗余码后数据不为0

    - 若数据在传输过程中最后两个1都变成了0，问接收端能否发现？

        能，添加冗余码后数据不为0

    - 采用CRC检验后，数据链路层的传输是否就变成了可靠的传输？

        不是，数据链路层只能保证无差错接收

3. 常用的局域网的网络拓扑有哪些种类？现在最流行的是哪种结构？为什么早期的以太网选择总线拓扑结构而不是星形拓扑结构，但现在却改为使用星形拓扑结构？

    - 现在最流行的是星形网。常用的有星形网、环形网和总线网。
    - 当时人们都认为有源器件容易出故障，不容易出故障的又太贵；无源的总线结构更加可靠，但实践证明，连接有大量站点的总线式以太网很容易出现故障，而现在专用的ASIC芯片的使用可以讲星形结构的集线器做的非常可靠，因此现在的以太网一般都使用星形结构的拓扑。

4. 假定1km长的CSMA/CD网络的数据率为1Gb/s。设信号在网络上的传播速率为200000km/s。求能够使用此协议的最短帧长。

    - 单程传播时间 t = 1km/200000km = 5μs，来回10μs，所以最小帧的发射时间不能小于10微秒
    - 按照题目，10μs可以发送10000bit(计算)，所以最短帧10000位或1250字节

5. 假定站点A和B在同一个10Mb/s以太网网段上。这两个站点之间的传播时延为225比特时间。现假定A开始发送一帧，并且在A发送结束之前B也发送一帧。如果A发送的是**以太网所容许**的最短的帧，那么A在检测到和B发生碰撞之前能否把自己的数据发送完毕？换言之，如果A在发送完毕之前并没有检测到碰撞，那么能否肯定A所发送的帧不会和B发送的帧发生碰撞？（提示：在计算时应当考虑到每一个以太网帧在发送到信道上时，在MAC帧前面还要增加若干字节的前同步码和帧定界符）

    - 10Mb/s以太网网段最短帧长512bit(按照[通常取的数值](#截断二进制指数退避))，加上首尾供576bit(8字节)
    - 发送结束前B也发送一帧，那么B只能在A发送后225bit内发送，因为传播时延为225比特时间，超出后因为**载波监听**会无法发送(0~224bit内发送)
    - 假设B在224bit时刻发送，那么A在224+225 = 449bit时检测到，所以不会发送完毕
    - 一样由于载波监听，B只能在前224bit发送，不会发生碰撞，就算按224bit发送，到达时是449bit，此时检测到碰撞了，不符合题意，反证可以肯定A所发送的帧不会和B发送的帧发生碰撞

6. 以太网交换机有何特点？用它怎样组成虚拟局域网？

    - 接口数量多；
    - 端口与主机或交换机相连，全双工工作；
    - 具有并行性，联通一台交换机上的端口，多对主机同时工作；
    - 相互通信的主机都独占传输媒体，无碰撞地传输数据；
    - 端口具有存储器，端口繁忙时可缓存。
    - 即插即用，自学习建立交换表。
    - 转发速率高，采用专用的结构芯片，硬件转发。

    由以太网交换机连接的局域网段构成与物理位置无关的逻辑组，同一个VLAN发送的帧中都有明确的标识符表示这个帧属于哪个VLAN
